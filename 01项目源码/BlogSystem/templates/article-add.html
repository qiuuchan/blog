<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <link rel="Bookmark" href="/favicon.ico">
    <link rel="Shortcut Icon" href="/favicon.ico"/>
    <!--[if lt IE 9]>
    <script type="text/javascript" src="/static/lib/html5shiv.js"></script>
    <script type="text/javascript" src="/static/lib/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/static/h-ui/css/H-ui.min.css"/>
    <link rel="stylesheet" type="text/css" href="/static/h-ui.admin/css/H-ui.admin.css"/>
    <link rel="stylesheet" type="text/css" href="/static/lib/Hui-iconfont/1.0.8/iconfont.css"/>
    <link rel="stylesheet" type="text/css" href="/static/h-ui.admin/skin/default/skin.css" id="skin"/>
    <link rel="stylesheet" type="text/css" href="/static/h-ui.admin/css/style.css"/>
    <!--[if IE 6]>
    <script type="text/javascript" src="/static/lib/DD_belatedPNG_0.0.8a-min.js"></script>

    <script>DD_belatedPNG.fix('*');</script>
    <![endif]-->
    <!--/meta 作为公共模版分离出去-->
    <link rel="stylesheet" type="text/css" href="/static/markdown/editormd.min.css"/>
    <link rel="stylesheet" type="text/css" href="/static/layui/css/layui.css"/>
    <title>新增文章</title>
    <meta name="keywords" content="H-ui.admin v3.1,H-ui网站后台模版,后台模版下载,后台管理系统模版,HTML后台模版下载">
    <meta name="description" content="H-ui.admin v3.1，是一款由国人开发的轻量级扁平化网站后台模板，完全免费开源的网站后台管理系统模版，适合中小型CMS后台系统。">
</head>
<body>
<article class="page-container">

    <div class="layui-form">
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button type="submit" class="layui-btn" lay-submit="" lay-filter="mySubmit">提交</button>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">文章标题</label>
            <div class="layui-input-block">
                {% if ArticleData is None %}
                     <input type="hidden" name="id"  value=""
                           placeholder="请输入" autocomplete="off" class="layui-input">
                    <input type="text" name="title" lay-verify="required" placeholder="请输入" autocomplete="off"
                           class="layui-input">
                {% else %}
                     <input type="hidden" name="id"  value="{{ ArticleData.id }}"
                           placeholder="请输入" autocomplete="off" class="layui-input">
                    <input type="text" name="title" lay-verify="required" value="{{ ArticleData.title }}"
                           placeholder="请输入" autocomplete="off" class="layui-input">

                {% endif %}
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">文章标签</label>
            <div class="layui-input-block">
                {% if ArticleData is None %}
                    <input type="text" name="tag" lay-verify="required" placeholder="请输入(用逗号分隔)" autocomplete="off"
                           class="layui-input">
                {% else %}
                 <input type="text" name="tag" value="{{ ArticleData.tag }}" lay-verify="required" placeholder="请输入(用逗号分隔)" autocomplete="off"
                           class="layui-input">
                {% endif %}
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">文章分类</label>
            <div class="layui-input-block">
                   <select name="classify" lay-verify="required" id="classify"> </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">文章状态</label>
            <div class="layui-input-block">


                {% if ArticleData is None %}
                    <input type="radio" name="status" value="0" title="草稿" checked>
                <input type="radio" name="status" value="1" title="发布">
                {% else %}
                    {% if ArticleData.status == 0 %}
                         <input type="radio" name="status" value="0" title="草稿" checked>
                        <input type="radio" name="status" value="1" title="发布">
                        {% else %}
                          <input type="radio" name="status" value="0" title="草稿" >
                        <input type="radio" name="status" value="1" title="发布" checked>
                    {% endif %}
                {% endif %}

            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">文章内容</label>
            <div class="layui-input-block">
                <div id="myEditor">
                    {% if ArticleData is None %}
                    <textarea style="display:none;">## 请开始您的表演</textarea>
                {% else %}
                    <textarea style="display:none;">{{ ArticleData.content }}</textarea>
                {% endif %}

                </div>
            </div>
        </div>
    </div>
</article>

<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="/static/lib/jquery/1.9.1/jquery.min.js"></script>

<script type="text/javascript" src="/static/lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="/static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="/static/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer /作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="/static/markdown/editormd.min.js"></script>

{#<script type="text/javascript" src="/static/lib/My97DatePicker/4.8/WdatePicker.js"></script>#}
{#<script type="text/javascript" src="/static/lib/jquery.validation/1.14.0/jquery.validate.js"></script>#}
{#<script type="text/javascript" src="/static/lib/jquery.validation/1.14.0/validate-methods.js"></script>#}
{#<script type="text/javascript" src="/static/lib/jquery.validation/1.14.0/messages_zh.js"></script>#}
{#<script type="text/javascript" src="/static/lib/webuploader/0.1.5/webuploader.min.js"></script>#}
<script type="text/javascript" src="/static/layui/layui.js"></script>


<script type="text/javascript">

    layui.use('form', function () {

        var editor = editormd("myEditor", {
            width: "100%",
            height: "720px",
            path: "/static/markdown/lib/", //插件地址
            imageUpload: true,
            imageFormats: ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
            imageUploadURL: "/UploadImg/",
            saveHTMLToTextarea: true,

        });

        var form = layui.form;

        /*获取文章分类 */
        $.ajax({
            url: '/ClassifyList/',
            type: "post",
            data: {
                "pageIndex": 1,
                "pageSize": 999,
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function (res) {
                let htmls = "<option value=''></option>";
                if (res.code == 2000) {
                    let data = res.data
                    for (let i = 0; i < data.length; i++) {
                        htmls += "<option value='" + data[i].pk + "'>" + data[i].fields.name + "</option>"
                    }
                    $('#classify').append(htmls)
                    form.render('select')
                } else {
                    $('#classify').append(htmls)
                }
            }
        });

        //表单提交
        form.on('submit(mySubmit)', function (data) {
            let datas = data.field;
            $.post('/articleOpt/',{
                    "id":datas['id'],
                    "title": datas['title'],
                    "tag": datas['tag'],
                    "classify_id": datas['classify'],
                    "content":datas['myEditor-markdown-doc'],
                    "status": datas['status'],
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },function (res) {
                    if(res.code==2000){
                        layer.msg(res.msg,function () {
                            var index = parent.layer.getFrameIndex(window.name);
                            parent.$('#refreshBtn').click();
                            window.parent.location.reload()
                            parent.layer.close(index);
                        })
                    }

            })
        });


    });


</script>
<!--/请在上方写此页面业务相关的脚本-->
</body>
</html>